import{_ as s,c as a,o as e,a3 as n}from"./chunks/framework.B_66xkI7.js";const i="/deploy-docs/public/log-01.BmHNsjVf.png",p="/deploy-docs/public/log-02.L_VB87Mk.png",t="/deploy-docs/public/log-03.CGBbR6zn.png",l="/deploy-docs/public/log-04.NbxWBma-.png",o="/deploy-docs/public/log-05.DGcJZFyV.png",c="/deploy-docs/public/log-06.DWz8Ldgz.png",d="/deploy-docs/public/grok-debugger.DCjFIZgw.png",A=JSON.parse('{"title":"ELKF","description":"","frontmatter":{},"headers":[],"relativePath":"docker/use/elkf/README.md","filePath":"docker/use/elkf/README.md"}'),r={name:"docker/use/elkf/README.md"},h=n(`<h1 id="elkf" tabindex="-1">ELKF <a class="header-anchor" href="#elkf" aria-label="Permalink to &quot;ELKF&quot;">​</a></h1><p><code>Elasticsearch</code> + <code>Logstash</code> + <code>Kibana</code> + <code>Filebeat</code> 搭建日志监控系统</p><ol><li><code>Filebeat</code> 采集日志</li><li><code>Logstash</code> 日志过滤</li><li><code>Elasticsearch</code> 日志搜索</li><li><code>Kibana</code> 日志展示</li></ol><div class="language-shell vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">shell</span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 运行</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">docker-compose</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -f</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> docker-compose.yml</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -p</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> elkf</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> up</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -d</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 当前目录下所有文件赋予权限(读、写、执行)  -- 解决es启动报错问题...</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -R</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 777</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /applicataion/middleware/elkf/elasticsearch</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;"># 解决logstash启动报错问题...</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">chmod</span><span style="--shiki-light:#A65E2B;--shiki-dark:#C99076;"> -R</span><span style="--shiki-light:#2F798A;--shiki-dark:#4C9A91;"> 777</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> /applicataion/middleware/elkf/logstash</span></span></code></pre></div><ol><li>ES访问地址：<a href="http://127.0.0.1:9200" target="_blank" rel="noreferrer"><code>ip地址:9200</code></a> 默认账号密码：<code>elastic/123456</code></li><li>kibana访问地址：<a href="http://127.0.0.1:5601" target="_blank" rel="noreferrer"><code>ip地址:5601</code></a> 默认账号密码：<code>elastic/123456</code></li></ol><hr><h3 id="kibana配置日志查看" tabindex="-1">Kibana配置日志查看 <a class="header-anchor" href="#kibana配置日志查看" aria-label="Permalink to &quot;Kibana配置日志查看&quot;">​</a></h3><blockquote><p>tips: 在<code>./app/filebeat/my-log/demo.log</code>中添加日志数据</p></blockquote><h4 id="_1、创建索引模式" tabindex="-1">1、创建索引模式 <a class="header-anchor" href="#_1、创建索引模式" aria-label="Permalink to &quot;1、创建索引模式&quot;">​</a></h4><p><a href="http://127.0.0.1:5601/app/management/kibana/indexPatterns" target="_blank" rel="noreferrer">http://127.0.0.1:5601/app/management/kibana/indexPatterns</a></p><p><img src="`+i+'" alt="img.png"><img src="'+p+'" alt="img.png"><img src="'+t+'" alt="img.png"><img src="'+l+'" alt="img.png"></p><h4 id="_2、查看日志" tabindex="-1">2、查看日志 <a class="header-anchor" href="#_2、查看日志" aria-label="Permalink to &quot;2、查看日志&quot;">​</a></h4><blockquote><p><a href="http://127.0.0.1:5601/app/discover" target="_blank" rel="noreferrer">http://127.0.0.1:5601/app/discover</a></p></blockquote><p><img src="'+o+'" alt="img.png"><img src="'+c+`" alt="img.png"></p><hr><h3 id="遇到的问题" tabindex="-1">遇到的问题 <a class="header-anchor" href="#遇到的问题" aria-label="Permalink to &quot;遇到的问题&quot;">​</a></h3><p>filebeat收集日志到logstash时乱码问题； 如果直接在springboot中推日志到logstash中则正常。</p><p>解决： 将 logstash 的输入配置从</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>input {</span></span>
<span class="line"><span>    tcp {</span></span>
<span class="line"><span>        mode =&gt; &quot;server&quot;</span></span>
<span class="line"><span>        host =&gt; &quot;0.0.0.0&quot;   # 允许任意主机发送日志</span></span>
<span class="line"><span>        type =&gt; &quot;demo&quot;      # 设定type以区分每个输入源</span></span>
<span class="line"><span>        port =&gt; 5044</span></span>
<span class="line"><span>        codec =&gt; json_lines # 数据格式</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>修改为</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>input {</span></span>
<span class="line"><span>    beats {</span></span>
<span class="line"><span>        port =&gt; 5044</span></span>
<span class="line"><span>    }</span></span>
<span class="line"><span>}</span></span></code></pre></div><h3 id="logstash-grok过滤器配置" tabindex="-1">logstash - Grok过滤器配置 <a class="header-anchor" href="#logstash-grok过滤器配置" aria-label="Permalink to &quot;logstash - Grok过滤器配置&quot;">​</a></h3><p>ex: java日志如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>2023-01-17 14:16:59.763  INFO 29332 --- [           main] com.zhengqing.demo.DemoApplication       : Started DemoApplication in 1.912 seconds (JVM running for 2.415)</span></span></code></pre></div><p>Grok 模式</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>(?&lt;datetime&gt;\\d{4}-\\d{2}-\\d{2}\\s\\d{2}:\\d{2}:\\d{2}\\.\\d{3})\\s+(?&lt;level&gt;\\w+)\\s+\\d+\\s+-+\\s\\[[^\\[\\]]+\\]\\s+(?&lt;class&gt;\\S+)\\s+:(?&lt;msg&gt;.*)</span></span></code></pre></div><p>处理后，数据格式如下</p><div class="language- vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code" tabindex="0"><code><span class="line"><span>{</span></span>
<span class="line"><span>  &quot;msg&quot;: &quot; Started DemoApplication in 1.912 seconds (JVM running for 2.415)&quot;,</span></span>
<span class="line"><span>  &quot;datetime&quot;: &quot;2023-01-17 14:16:59.763&quot;,</span></span>
<span class="line"><span>  &quot;level&quot;: &quot;INFO&quot;,</span></span>
<span class="line"><span>  &quot;class&quot;: &quot;com.zhengqing.demo.DemoApplication&quot;</span></span>
<span class="line"><span>}</span></span></code></pre></div><p>可以到 <a href="http://127.0.0.1:5601/app/dev_tools#/grokdebugger" target="_blank" rel="noreferrer">http://127.0.0.1:5601/app/dev_tools#/grokdebugger</a> 中测试 <img src="`+d+'" alt="img.png"></p>',29),g=[h];function k(u,m,b,_,v,y){return e(),a("div",null,g)}const f=s(r,[["render",k]]);export{A as __pageData,f as default};
